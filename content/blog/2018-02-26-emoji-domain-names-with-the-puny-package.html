---
title: emoji domain names with the puny package
author: Romain FranÃ§ois
date: '2018-02-26'
slug: emoji-domain-names-with-the-puny-package
categories: []
tags: []
---



<p>Typical sunday night, lost in several inception layers of I donâ€™t know
how I got here, what I am doing here and what I was looking for in the first place.</p>
{{< tweet "967904124506386433" >}}
<p>So, some extensions allow arbitrary utf-8 characters in the domain name, but
more importantly you can have arbitrary characters in sub domains. Next thing you
know, obviously Iâ€™m not going to stop at accents or cedilla, Iâ€™m on a
mission to spread emojis everywhere.</p>
<p>Emojis are characters, just sequence of utf-8 encoded bytes. Iâ€™ve been
playing with the <a href="https://github.com/hadley/emo"><code>emo</code></a> package to make it
easy to include and extract emojis, and the
<a href="https://github.com/ThinkR-open/utf8splain"><code>utf8splain</code></a> to extract some information
about unicode runes (aka code points).</p>
<pre class="r"><code>(s &lt;- emo::ji_glue( &quot;emojis :party: &quot;))</code></pre>
<pre><code>## emojis ðŸŽ‰</code></pre>
<pre class="r"><code>unclass(s)</code></pre>
<pre><code>## [1] &quot;emojis \U0001f389 &quot;</code></pre>
<pre class="r"><code>utf8splain::runes(s)</code></pre>
<pre><code>## utf-8 encoded string with 9 runes
## 
## U+0065             65                              01100101    Latin Small Letter E
## U+006D             6D                              01101101    Latin Small Letter M
## U+006F             6F                              01101111    Latin Small Letter O
## U+006A             6A                              01101010    Latin Small Letter J
## U+0069             69                              01101001    Latin Small Letter I
## U+0073             73                              01110011    Latin Small Letter S
## U+0020             20                              00100000    Space               
## U+1F389   F0 9F 8E 89   11110000 10011111 10001110 10001001    Party Popper        
## U+0020             20                              00100000    Space</code></pre>
<p>Typically domain names are only made of boring ascii, but
<a href="https://en.wikipedia.org/wiki/Punycode">punycode</a> gives a way to encode a string
that may contain any unicode characters into a string that only has ascii.</p>
<p>There are <a href="https://www.punycoder.com">online tools</a> to perform the encoding
and decoding, and firing the github search engine, I could quickly find
the simple enough <a href="https://github.com/bnoordhuis/punycode">punycode C library</a>.</p>
<p>I knew this was going to change my day, I only wish we were able to open
the door of my <a href="http://coworkinmontpellier.org">coworking space</a> space
without the help of a locksmith, but I guess thatâ€™s a story for another day,
and I had not agreed to install the updates on my mac. Anyway, once the elements
would finally give me a break, I was able to wrap the library in the
<a href="https://github.com/romainfrancois/puny">puny</a> package and its <code>code</code>
and <code>decode</code> functions.</p>
<pre class="r"><code>puny::code( &quot;crÃ¨me brÃ»lÃ©e&quot; )</code></pre>
<pre><code>## [1] &quot;crme brle-13ar8s&quot;</code></pre>
<pre class="r"><code>puny::code( emo::ji_glue(&quot;emojis :party: everywhere&quot;) )</code></pre>
<pre><code>## [1] &quot;emojis  everywhere-3q59q&quot;</code></pre>
<p>If you add <code>domain=TRUE</code>, the function adds the <code>xn--</code> prefix and makes
something suitable for a domain name.</p>
<pre class="r"><code>puny::code( emo::ji(&quot;package&quot;), domain = TRUE )</code></pre>
<pre><code>## [1] &quot;xn--cu8h&quot;</code></pre>
<p>So that for example <a href="ðŸ“¦.purrple.cat" class="uri">ðŸ“¦.purrple.cat</a>
is (for now) a skeleton hugo site generated by <a href="https://bookdown.org/yihui/blogdown/">blogdown</a>
and deployed on <a href="https://www.netlify.com">netlify</a>. Eventually, I guess
it will contain <a href="https://github.com/r-lib/pkgdown">pkgdown</a> sites for my
packages, but <a href="https://github.com/r-lib/pkgdown/issues/520">I could not get pkgdown to work today</a>,
although I have not tried after the issue was fixed â€¦ <span class="note">a nice side effect is that
I could discover that <code>pkgdown</code> uses my <a href="https://github.com/romainfrancois/highlight">highlight</a>
package and I was able to offer <a href="https://github.com/r-lib/pkgdown/pull/523">a pull request</a>
because <code>pkgdown</code> was using the interface of <code>highlight</code> before I
broke it (for the greater good) last summer. </span></p>
<p>Aaaaaaanyway, to do this, Iâ€™ve had to use the encoded name
(xnâ€“cu8h) in both netlify:</p>
<p><img src="/img/puny/netlify.png" /></p>
<p>â€¦ and the DNS settings on my registrar:</p>
<pre><code>xn--cu8h 1800 IN CNAME dreamy-hypatia-b7499e.netlify.com.</code></pre>
<p>Unfortunately, all browsers donâ€™t treat punycode the same way. On safari,
everything looks fine, I can browse to
<a href="ðŸ“¦.purrple.cat" class="uri">ðŸ“¦.purrple.cat</a>
and thatâ€™s how it looks like.</p>
<p><img src="/img/puny/safari.png" /></p>
<p>But chrome (at least the version I have) only ðŸ˜¢ echoes
the encoded subdomain.</p>
<p><img src="/img/puny/chrome.png" /></p>
